<html>
    <head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <link rel="stylesheet" href="signup.css">
    </head>
    <body>
      <div class="logo">  
        <center>
        <h3>www.2plateproductions.com</h3>
<<<<<<< HEAD
        <img src="../IndexImages/1TwoPlateProductionsLogo.png" alt="2plateproductions">
        <h3>by Luca the arched fingertips, Gabriel and Kyan</h3>
=======
        <img src="../IndexImages/1Two Plate Productions Logo.png" alt="2plateproductions">
        <h3></h3>
>>>>>>> e204490987b1d24a9ff7c9399baf949495b20842
</center>
</div>
<br>
<br>
<div class="sign">      <center>      Keep name shorter than 17 characters, it may not contain special characters. <br>
  <label id = "okayquestionmark" style = "color:rgb(168, 9, 9)">Please enter a username for it to be checked for originality</label><br>
      Username:<input type="text" id="username" maxlength = "16" onchange = "check()"></input><br>
      <!--<button id="checktemp" onclick = "check()">check</button><br>-->
      Password:<input type="password" id="password" maxlength = "512"></input><br>
      <br>Your Account will only be created if it has a unique username<br>
      <button id="send" onclick = "sendform()">Submit </button><br>
      <label id = "formsubmitted" style = "color:rgb(168, 9, 9)">After Submitting please wait</label>
      <br>
    </center></div>
    <center><video width="640" height="480" controls>
      <source src="../IndexImages/namrtag.mp4" type="video/mp4">
    </video></center>
    </body>        
</html>
    <!--alert before allowing to create account
    //once signed in let them know that if their request is valid it will be processed, their account should be active within the minuit assuming all is well-->

<script>
//checke verything, validate and make sure not 0 also make sure usernames are unique
//to make sure unique make the button run this script function
//the function in this script send a http request asking if exists, if false, the form won't be sent
//DATA WILL BE REEVALUATED IN SERVER BEFORE BEING ENTERED INTO DATABASE

var validated = false; //I'll tell you now,don't get your hopes up, this isn't the actual varification variable, you can't double up usernames
//make part of larger function



function check(id = 'username'){
    console.log("got here");
    console.log(document.getElementById(id).value);
    sendcheck("http://localhost:8080/usernamechecks", document.getElementById(id).value);
}

//document.getElementById("username").onchange = check("username");
//document.getElementById("checktemp").onclick = check("username");

//that's some fancy js
//https://www.w3schools.com/js/js_api_fetch.asp
async function sendcheck(to, usernametocheck) { //why does it need the identifier
  let response = await fetch(to,{method:"Post",headers:{'Content-Type': 'text/html'},body:usernametocheck}); //this why?
  let result = await response.text();//why does this have to be async
  //console.log(result);
  let parsedresult = JSON.parse(result);
  document.getElementById("okayquestionmark").innerText = parsedresult.message;
  console.log("checksent");
  return parsedresult.bad;
  //console.log(response.text());
  //console.log(result);
  //console.log(parsedresult);
  //console.log(parsedresult.message);
  //console.log(parsedresult.bad);
}

//regarding future expantion of encryption keys let if no key provided, it will default to waht is being used here, or I just put this key in lol prob do that
//also in future, give moderator controll, change state of wether a message is vissable

//if you tamper with these you may never be able to log into that account and I won't be able to help you

// source: http://stackoverflow.com/a/11058858
function str2ab(str) {
    var buf = new ArrayBuffer(str.length * 2); // 2 bytes for each char
    var bufView = new Uint8Array(buf);
    for (var i = 0, strLen = str.length; i < strLen; i++) {
      bufView[i] = str.charCodeAt(i);
    }
    return buf;
  }

  // source: http://stackoverflow.com/a/11058858
function ab2str(buf) {
    return String.fromCharCode.apply(null, new Uint8ClampedArray(buf));
  }

//I just fucking realised hashing here would only like delay an attacker by a few minutes
function sendform(){ //'form' lol
//account security note: can be edited so different username is sent than what was checked, shouldn't be an issue because all is recheched on other server
//although the original dude should have no issue because the database should check only the first result for names idk if i've even designed that sytem yet tho xD
//async so strange
//https://stackoverflow.com/questions/47227550/using-await-inside-non-async-function
//^ explanation to clarify abit if u ever need
//hello future pickle
//lol there is 0 error handling here of any kind
    let username = document.getElementById("username").value
    let password = document.getElementById("password").value

    console.log("username: " + username);
    console.log("password: " + password);

    //check if values non empty



    const usernamegood = sendcheck("http://localhost:8080/usernamechecks", username);//I changed this from signupform and nothing changed.... um
    console.log(usernamegood);
    usernamegood.then(result => {//idk if I have to put it in or not, stackoverflow answer seems to suggest that await is equal to this so this should be fine
       //also actual check made on server
       if(result == false){
        //const digest = crypto.subtle.digest('SHA-256', str2ab(password + "v7ArvELs"));//< this is clientside hash, serverside will have it's own hash, thought it doesn't realy matter tho lol xD
        //digest.then(result2 =>{
            //send form
            
          //given up on using crypto thing

            let requestjsontext = "{\"username\":\"" + username + "\",\"password\":\""+password+"\"}";//do I have to initialise?
          // let requestjson = JSON.parse(requestjsontext);
           console.log(requestjsontext);
            let response = fetch("http://localhost:8080/signupform",{method:"Post",headers:{'Content-Type': 'application/json'},body:requestjsontext});
            response.then(result3=>{
                console.log("form should have been sent:" + result3); //will be designed to respond with success
                document.getElementById("formsubmitted").innerText = "Your account creation request has probably sent and recieved ¯\\_(ツ)_/¯"
            })
        //});
        }   
    });


    
}


</script>



