<html>
    <head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="createthread.css"></head>
    <body>
        <div class="logo">  
            <center>
            <h3>www.2plateproductions.com</h3>
            <img src="../IndexImages/1TwoPlateProductionsLogo.png" alt="2plateproductions">
            <h3>by Luca the arched fingertips, Gabriel and Kyan</h3>
    </center>
    </div>
    <br>
    <br>
    <div class="flexbox">
    <div class="one">
        <img src="../IndexImages/oneplatehovercraftad.png" alt="">
    </div>
    <div class="sign"> 
        <center>
            Keep name shorter than 17 characters, it may not contain special characters. <br>
            <label id = "okayquestionmark" style = "color:rgb(168, 9, 9)">Please enter a threadname for it to be checked for originality</label><br>
                ThreadName:<input type="text" id="threadnamebox" maxlength = "16" onchange = "check()"></input><br>
                <!--<button id="checktemp" onclick = "check()">check</button><br>-->
                <br>Validate Credentials:<br>
                Username:<input type="text" id="username" maxlength = "16"></input><br>
                Password:<input type="password" id="password" maxlength = "512"></input><br><br> (note: system cannot yet inform you wether your login information was correct)
                <br>The thread will only be created if it has a unique name<br><br>
                <button id="send" onclick = "sendform()">Submit </button><br>
                <label id = "formsubmitted" style = "color:rgb(168, 9, 9)">After Submitting please wait</label>
                </center>
        </div> 
        <div class="two">
            <img src="../IndexImages/twoplatehovercraftad.png" alt="">
        </div>
    </div>
    </body>
</html>
    <!--alert before allowing to create account
    //once signed in let them know that if their request is valid it will be processed, their account should be active within the minuit assuming all is well-->

<script>
//checke verything, validate and make sure not 0 also make sure usernames are unique
//to make sure unique make the button run this script function
//the function in this script send a http request asking if exists, if false, the form won't be sent
//DATA WILL BE REEVALUATED IN SERVER BEFORE BEING ENTERED INTO DATABASE

var validated = false; //I'll tell you now,don't get your hopes up, this isn't the actual varification variable, you can't double up usernames
//make part of larger function



function check(id = 'threadnamebox'){
    console.log("got here");
    console.log(document.getElementById(id).value);
    sendcheck("http://localhost:8080/threadnamechecks", document.getElementById(id).value);
}

//document.getElementById("username").onchange = check("username");
//document.getElementById("checktemp").onclick = check("username");

//that's some fancy js
//https://www.w3schools.com/js/js_api_fetch.asp
async function sendcheck(to, threadnametocheck) { //why does it need the identifier
  let response = await fetch(to,{method:"Post",headers:{'Content-Type': 'text/html'},body:threadnametocheck}); //this why?
  let result = await response.text();//why does this have to be async
  //console.log(result);
  let parsedresult = JSON.parse(result);
  document.getElementById("okayquestionmark").innerText = parsedresult.message;
  //console.log("checksent"); lol this should be up above no?
  return parsedresult.bad;

}


function sendform(){ 

    let username = document.getElementById("username").value
    let password = document.getElementById("password").value
    let threadname = document.getElementById("threadnamebox").value

    const usernamegood = sendcheck("http://localhost:8080/threadnamechecks", username);//I changed this from signupform and nothing changed.... um
    console.log(usernamegood);
    usernamegood.then(result => {//idk if I have to put it in or not, stackoverflow answer seems to suggest that await is equal to this so this should be fine
       //also actual check made on server
       if(result == false){
        //const digest = crypto.subtle.digest('SHA-256', str2ab(password + "v7ArvELs"));//< this is clientside hash, serverside will have it's own hash, thought it doesn't realy matter tho lol xD
        //digest.then(result2 =>{
            //send form
            
          //given up on using crypto thing

            let requestjsontext = "{\"threadname\":\"" + threadname +"\",\"username\":\"" + username + "\",\"password\":\""+password+"\"}";//do I have to initialise?
          // let requestjson = JSON.parse(requestjsontext);
           console.log(requestjsontext);
            let response = fetch("http://localhost:8080/createthreadform",{method:"Post",headers:{'Content-Type': 'application/json'},body:requestjsontext});
            response.then(result3=>{
                console.log("form should have been sent:" + result3); //will be designed to respond with success
                document.getElementById("formsubmitted").innerText = "Your thread creation request has probably sent and recieved ¯\\_(ツ)_/¯"
            })
        //});
        }   
    });


    
}


</script>
